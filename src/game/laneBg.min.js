import{Lane as e}from"./lane.js";import*as t from"three";const a=256,r={x:0,y:-.9,z:-5};export default class LaneBgManager{constructor(e){this.lane=e,this.skin=e.skin,this.pMesh=null,this.checkStartTime=0,this.width=.23,this.height=.5,this.displayTime=150,this.reqRemoveGradient=!1,this.pos=r}init(){const e=this.#e(),t=this.#t();return this.pMesh=this.#a(e,t),this.lane.laneGroup.add(this.pMesh),this.lane.checkAndRemove=null,this}#e(){const e=new t.PlaneGeometry(1,1);return e.translate(0,.5,0),e.scale(this.width,this.height,1),e}#t(){return new t.MeshBasicMaterial({color:16777215,transparent:!0,opacity:0})}#a(e,a){const r=new t.Mesh(e,a);return r.position.set(this.pos.x,this.pos.y,this.pos.z),r.name="laneBg",r}add(e,t,a=0){const r=this.#r(this.#i(e,t,a));return this.#s(this.pMesh,r),this.pMesh}#n(e,t,r,i){let s;switch(t){case 0:s=e.createLinearGradient(0,0,a,0);break;case 1:s=e.createLinearGradient(a,0,0,0);break;case 2:s=e.createLinearGradient(0,a,0,0);break;case 3:s=e.createLinearGradient(0,0,0,a);break;default:throw new Error(`Invalid direction: ${t}`)}return s.addColorStop(0,r),s.addColorStop(1,i),s}#i(e,t,r){const i=document.createElement("canvas");i.width=a,i.height=a;const s=i.getContext("2d"),n=this.#n(s,r,e,t);return s.fillStyle=n,s.fillRect(0,0,a,a),i}#r(e){const a=new t.Texture(e);return a.needsUpdate=!0,a}#s(e,t){return e.material.map=t,e.material.transparent=!1,e.material.opacity=1,e.material.needsUpdate=!0,e}#h(e){e.material.map=null,e.material.transparent=!0,e.material.opacity=0,e.material.needsUpdate=!0}get clockTime(){return this.lane.agent?.engine?.clock.getElapsedTime()??0}update(){if(!this.lane.agent||!this.lane.agent.engine||!this.reqRemoveGradient)return;this.clockTime-this.checkStartTime>=this.displayTime/1e3&&(this.#h(this.pMesh),this.checkStartTime=0,this.reqRemoveGradient=!1)}requestRemoval(){this.lane.agent&&this.lane.agent.engine&&!this.reqRemoveGradient&&(this.reqRemoveGradient=!0,this.checkStartTime=this.clockTime)}}